# 리액트는 언제 컴포넌트를 렌더링 하나요?

## TL;DR

- 리액트는 컴포넌트를 다음과 같은 상황일 경우 렌더링합니다.
  - 컴포넌트에 예정된 상태 업데이트가 있는 경우.
    - 컴포넌트에서 사용된 커스텀 훅의 예정된 업데이트가 있는 경우도 포함합니다.
  - 부모 컴포넌트가 렌더링 되고 **리렌더링에서 제외되는** 기준에 충족하지 않을 경우. 제외되는 기준은 다음의 네가지 조건을 모두 동시에 충족해야합니다.
    - 컴포넌트가 이전에 렌더링 되었어야 함. 즉 이미 마운트 되어있어야 함.
    - 변경된 `props`(참조)가 없어야 함.
    - 컴포넌트에서 사용하고 있는 context 값이 변경되지 않아야 함
    - 컴포넌트에 예정된 상태 업데이트가 없어야 함
- 아마도 성능 문제가 발생할 때까지 불필요한 리렌더링에 대해서는 걱정할 필요가 없을 것입니다.

## "렌더"는 무엇을 의미하나요?

눈치채셨는지 모르겠지만, 저는 "컴포넌트가 렌더링 한다"가 아닌 "리액트가 컴포넌트를 렌더링 한다"라고 계속 말하고 있었습니다. 보통 사람들은 이 둘을 구별하지 않고 제멋대로 결정하여 말하곤 합니다. 까다롭다고 생각하실 수도 있습니다만, 이 글에서는 "리액트가 컴포넌트를 렌더링 한다"만을 사용할 것입니다. 이 편이 리액트가 어떻게 동작하는지 더 정확하게 설명하기 때문입니다. 컴포넌트(UI에서 업데이트를 예약할 수 있도록 **리액트에 의해 강화된 함수**)는 리액트에 의해 호출되는 것입니다. 컴포넌트가 스스로의 상태를 능동적으로 변화시켰든 다른 변화 때문인지든 상관없이 리액트에 의해 호출되는 것입니다.

리액트의 핵심 디자인 원칙 중 [하나](https://reactjs.org/docs/design-principles.html#scheduling)에 따라 리액트는 UI 스케줄링 및 업데이트를 완전히 제어할 수 있습니다.

이는 몇가지 의미를 가집니다.

- 컴포넌트가 만든 하나의 상태 업데이트가 반드시 하나의 렌더링(리액트에 의해 한 번의 컴포넌트 호출)으로 변환되는 것은 아닙니다. 그 이유는 다음과 같습니다.
  - 리액트 컴포넌트의 상태에 의미 있는 변화가 없다고 생각할 수 있습니다.(`Object.is`에 의해 결정됩니다.)
  - 리액트는 상태 업데이트를 하나의 렌더 패스로 일괄처리하려 합니다.
    - 하지만 리액트는 promise가 resolve되는 타이밍을 제어할 수 없기 때문에 promise에서의 상태 업데이트를 일괄 처리할 수 없습니다. `setTimeout`, `setInterval`및 `requestAnimationFrame`과 같이 별도의 이벤트 루프 콜 스택에서 실행되는 네이티브 이벤트 핸들러도 마찬가지입니다.
  - 리액트는 여러 렌더 패스로 작업을 분할할 수도 있습니다.(concurrent 리액트 기능)
- 리액트는 다양한 이유로 컴포넌트를 렌더링(즉, 함수 호출) 할 수 있기 때문에 컴포넌트를 한 번 렌더링 하는 것이 UI의 시각적 업데이트로 반드시 변환되지는 않습니다.

리액트 17에서는 일부 상태 업데이트를 일괄 처리할 수 없습니다.(예: promise에서의 업데이트). 리액트는 promise가 resolve되는 타이밍을 제어할 수 없기 때문이며 같은 맥락에서 훨씬 나중에 완전히 별도의 이벤트 루프 호출 스택에서 실행되는 네이티브 이벤트 핸들러, `setTimeout`, `setInterval`및 `requestAnimationFrame`도 마찬가지입니다. 리액트 18에서는 모든 상태 업데이트를 자동 일괄 처리할 수 있습니다.

그러나 리액트가 렌더링을 제어할 수 있다고 해서 컴포넌트를 렌더링 하는 시기나 이유에 대해 신경쓰지 않아도 된다는 의미는 아닙니다. 리액트에 마냥 의존하는 것 대신 리액트가 컴포넌트를 렌더링 하는데 사용하는 기본 메커니즘을 이해한다면 성능 문제에 직면했을 때 쉽게 해결할 수 있을 것입니다.

맥락에 따라서 "업데이트"가 무엇을 의미하는지 정의해 봅시다.

"렌더"라는 단어와 함께 "업데이트"라는 단어 또한 많이 사용될 것입니다. "업데이트"는 맥락에 따라서 의미가 달라질 수 있습니다.

"컴포넌트가 업데이트를 예약한다"의 업데이트는 컴포넌트가 자체의 상태를 변경하고 리액트에 변경 내용을 UI에 반영하도록 요청함을 의미합니다. 여기서 업데이트는 리액트가 컴포넌트를 렌더링(호출)하는 이유입니다. 리액트가 컴포넌트를 렌더링 할지 여부, 리액트가 컴포넌트를 렌더링 하기로 결정한 횟수 및 렌더링 하기로 결정하는데 발생한 지연 시간은 다양한 요인에 따라 달라집니다.

"리액트가 UI를 업데이트 한다"의 업데이트는 리액트가 기존 DOM 노드를 변환하거나 DOM 트리의 내부 표현과 일치하도록 새로운 DOM 노드를 생성한다는 의미입니다. 여기서 업데이트는 컴포넌트를 렌더링한 결과입니다.
