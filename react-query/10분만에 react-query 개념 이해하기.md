# 10분만에 react-query 개념 이해하기

리액트 쿼리는 서버에서 가져온 데이터를 웹 브라우저 앱에서 사용하기 쉽게 도와주는 기술이다.

서버는 클라이언트에게 데이터베이스에 있는 정보를 전달해주는 역할을 하는데, 여기서 서버는 api 서버, 클라이언트는 웹 브라우저에서 실행되는 우리가 작성한 리액트 앱을 의미한다.

데이터베이스에서 가져온 데이터를 클라이언트에서 보여주기 위해 우리는 ajax를 사용하는데, 이 때 서버에서 가져오는 데이터를 서버의 상태라고 한다.

서버는 특정 시점에 클라이언트의 요청에 대해 데이터 베이스에서 유저 정보를 가져와 서버의 상태 값을 만들어낸다.

서버는 특정 시점에 클라이언트의 요청에 대해 데이터베이스에서 유저 정보를 가져와 서버의 상태값을 만들어낸다. 데이터베이스에 있는 값을 그대로 클라이언트에게 전달할 수도 있고, 요청에 담긴 특정 값을 이용해 정보를 가공해서 메모리에 들고 있다.

그리고 이 정보를 클라이언트에게 전달해준다.

## Client State

client state는 크게 두가지로 나눌 수 있다.

- client에서 자체적으로 만드는 state(최초 데이터의 발생지가 클라이언트)
- server에서 전달받은 값으로 만드는 state(최초 발생지가 서버)

클라이언트가 자체적으로 만드는 state는 대개 UI를 담당하는 부분으로 모달이 열리고 닫았는지, 어떤 버튼이 클릭되었는지, 지금 창이 리사이징 되고 있는지에 대한 메타 정보를 담은 상태값이다.

두번째는 server state -> client state로 가져오는 부분에 대한 내용이다.

리액트는 서버의 상태 값을 받아오는데 정해진 모범 답안이라는 것은 없다.

> Out of the box, React applications do not come with an opinionated way of fetching or updating data from your components so developers end up building their own ways of fetching data. - tanstack.com

컴포넌트의 생명 주기를 파악한 후 적절한 시점에 ajax 호출을 하고 서버에서 데이터를 받아온다.
그리고 useState를 사용할 경우 데이터를 불러와 setState호출을 통해 응답 당시의 server state를 component state로 wrapping 한다.

```js
useEffect(() => {
  customFetch("...").then(setState)
}, [])
```

이렇게 클라이언트 앱은 server state와 client state에 대한 로직 처리를 나누어 선언해주어야 합니다.

## react query가 해결해주는 문제

간편한 server state 수급 방식

앱이 간단하다면 useState와 contextAPI만 사용하더라도 대부분의 client state를 다룰 수 있다. 하지만 복잡도가 올라가고 성능 향상에 대한 필요성이 생기는 시점이 예상된다면, 이미 잘 만들어진 바퀴인 상태관리 도구를 선택하는게 가장 합리적인 선택이 될지도 모른다.

지금처럼 상태 관리 툴이 다양하지 않았을 당시만 해도 redux, mobx 두가지가 상태 관리 도구의 주류 메인 스트림이었다. 그리고 서버 상태값을 받아오기 위해

- redux는 thunk, saga, observable과 개념을 차용했고
- mobx는 자체적으로 클래스나 함수를 만들어 async await을 통해 데이터를 가져오고, 이를 미리 선언한 observable한 필드에 초기화하여 사용해야했다.

이것이 리액트를 처음 배우는 사람들에게 있어 작지 않은 진입 장벽이 되었다.
react-query는 hook 기반의 로직들로 되어있어서 해당 훅을 사용하는 컴포넌트에서 상태 값의 변경을 간편하게 파악하여 리렌더링을 유발하게 해준다.

## 캐시

react query를 사용하기 전까지 state라는 용어는 암묵적으로 client의 state를 가르켰다. react qeury가 server state라는 개념을 만든 것이 아니라 client state만 신경쓰기에도 프론트엔드 개발자가 해줘야할 작업들이 많았던 것이다.

A페이지의 특정 컴포넌트에서 불러온 데이터를 페이지 전환하여 B페이지에서 재사용하기 위해서라면, A, B 페이지에서는 state store에 해당 데이터가 이미 존재하는지에 대한 로직이 각기 들어가 있어야하고(재호출 방지), 해당 데이터의 유효성에 대한 로직을 추가로 작성해줘야한다.

리액트 쿼리는 데이터의 캐시 처리를 간편하게 할 수 있는 인터페이스를 제공한다.

- 몇 초 이후에는 데이터가 유효하지 않을 것으로 간주하고 데이터를 다시 불러온다.
- 데이터에 변경점이 있는 경우에만 리렌더링을 유발.
- 유저가 탭을 이동했다가 다시 돌아왔을 때 데이터를 다시 불러온다.
- 데이터를 다시 호출할 때 응답이 오기 전까지는 이전데이터를 계속 보여준다. 필요에 따라서는 로딩바와 같은 대안 UI를 보여주기 위해 loading state를 기본적으로 제공한다.

fetch api를 사용하여 데이터를 불러올 때 에러 처리를 추가적으로 해줘야 한다는 불편함을 axios가 해결해주듯이, 클라이언트와 서버의 상태 값을 일치시켜줘야 하는 요구사항에서 부가적으로 생길 수 있는 로직들을 리액트 쿼리의 api와 인터페이스로 간단하게 해결할 수 있도록 도와주는 것이다.
